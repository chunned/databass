{% include 'header.html' %}
<body>
{% include 'navbar.html' %}

<div>
    <table class="release-table">
        <thead>
            <tr>
                <th>
                    <img src="{{ data.release.art }}" style="max-height: 75vh; max-width: 100%;" alt="Album art">
                </th>
                <th>
                    <h1><a href="/artist/{{ data.artist.id }}" class="link">{{data.artist.name}}</a></h1>
                </th>
                <th>
                    <h2>{{ data.release.title }}</h2>
                </th>
                <th>
                    <a href="/label/{{ data.label.id }}" class="link">{{ data.label.name }}</a>
                </th>
                <th>
                    <a href="/edit/{{ data.release.id }}" class="link">edit</a>
                </th>
                <th>
                   <p class="link" id="delete" data-id="{{ data.release.id }}">delete</p>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <p>listened: {{ data.release.listen_date }}</p>
                </td>
                <td>
                    <p>rating: {{ data.release.rating }}%</p>
                </td>
                <td>
                    <p>released: {{ data.release.release_year }}</p>
                </td>
                <td>
                    <p>genre: {{ data.release.genre }}</p>
                </td>
                <td>
                    <p>tags: {{ data.release.tags }}</p>
                </td>
                <td>
                    <p>country: {{ data.release.country }}</p>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    function showPopup() {
        let releaseId = deleteButton.getAttribute('data-id');
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.innerHTML = `
        <p>Are you sure? This cannot be undone.</p>
        <button id="confirm" class="search-btn">yes</button>
        <button id="cancel" class="search-btn">no</button>
        `;
        document.body.appendChild(popup);
        // If 'yes' button is pressed, delete the release
        popup.querySelector('#confirm').addEventListener('click', function() {
            fetch('/delete', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: releaseId })
            })
            .then(response => {
                window.location.href = response.url;
            })
        });
        popup.querySelector('#cancel').addEventListener('click', function() {
            document.body.removeChild(popup);
        });

    }
    let deleteButton = document.querySelector("#delete");
    deleteButton.addEventListener("click", function() {
        showPopup();
    });
</script>

</body>