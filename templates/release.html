{% include 'header.html' %}
<body>
{% include 'navbar.html' %}

<div class="page-content">
    <div>
        <div style="display:flex; align-items: center;">
            <h1><a href="/artist/{{ data.artist.id }}" class="link">{{data.artist.name}}</a> - {{ data.release.title }}</h1>
            <p>&nbsp &nbsp <a href="/label/{{ data.label.id }}" class="link">{{ data.label.name }}</a></p>
            <p>&nbsp &nbsp &nbsp &nbsp <a href="/edit/{{ data.release.id }}" class="link">edit</a>&nbsp &nbsp &nbsp &nbsp </p>
            <p class="link" id="delete" data-id="{{ data.release.id }}">delete</p>
        </div>
        <img src="{{ data.release.art }}" style="max-height: 75vh; max-width: 100%;" alt="Album art">
    </div>
    <div>
        <div class="release-table">
            <table>
                <tr>
                    <td>
                        released: {{ data.release.release_year }}
                    </td>
                    <td>
                        genre: {{ data.release.genre }}
                    </td>
                    <td>
                        rating: {{ data.release.rating }}
                    </td>
                    <td>
                        runtime: {{ data.release.runtime // 60000 }} min
                    </td>
                </tr>
                <tr>
                    <td>
                        listened: {{data.release.listen_date }}
                    </td>
                    <td></td>
                    <td>
                        <a href="/artist/{{ data.artist.id }}" class="link">go to artist</a>
                    </td>
                    <td>
                        <a href="/label/{{ data.label.id }}" class="link">go to label</a>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <p>{{data.release}}</p>
    <p>{{data.artist}}</p>
    <p>{{data.label}}</p>

</div>

<script>
    function showPopup() {
        let releaseId = deleteButton.getAttribute('data-id');
        const popup = document.createElement('div');
        popup.className = 'popup';
        popup.innerHTML = `
        <p>Are you sure? This cannot be undone.</p>
        <button id="confirm" class="search-btn">yes</button>
        <button id="cancel" class="search-btn">no</button>
        `;
        document.body.appendChild(popup);
        // If 'yes' button is pressed, delete the release
        popup.querySelector('#confirm').addEventListener('click', function() {
            fetch('/delete', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: releaseId })
            })
            .then(response => {
                window.location.href = response.url;
            })
        });
        popup.querySelector('#cancel').addEventListener('click', function() {
            document.body.removeChild(popup);
        });

    }
    let deleteButton = document.querySelector("#delete");
    deleteButton.addEventListener("click", function() {
        showPopup();
    });
</script>

</body>